{"ast":null,"code":"import { BehaviorSubject, tap } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor(http, router) {\n      this.http = http;\n      this.router = router;\n      this.apiUrl = `${environment.apiUrl}/auth`;\n      this.currentUserSubject = new BehaviorSubject(null);\n      this.currentUser$ = this.currentUserSubject.asObservable();\n      const token = this.getToken();\n      if (token) {\n        const userData = localStorage.getItem('user');\n        if (userData) {\n          this.currentUserSubject.next(JSON.parse(userData));\n        }\n      }\n    }\n    register(data) {\n      return this.http.post(`${this.apiUrl}/register`, data);\n    }\n    login(data) {\n      return this.http.post(`${this.apiUrl}/login`, data).pipe(tap(response => {\n        if (response.token) {\n          localStorage.setItem('token', response.token);\n          localStorage.setItem('user', JSON.stringify(response));\n          this.currentUserSubject.next(response);\n        }\n      }));\n    }\n    verifyEmail(token) {\n      return this.http.get(`${this.apiUrl}/verify-email?token=${token}`);\n    }\n    requestPasswordReset(email) {\n      return this.http.post(`${this.apiUrl}/password-reset/request`, {\n        email\n      });\n    }\n    confirmPasswordReset(token, newPassword) {\n      return this.http.post(`${this.apiUrl}/password-reset/confirm`, {\n        token,\n        newPassword\n      });\n    }\n    enableTwoFactor() {\n      return this.http.post(`${this.apiUrl}/2fa/enable`, {});\n    }\n    disableTwoFactor() {\n      return this.http.post(`${this.apiUrl}/2fa/disable`, {});\n    }\n    confirm2FA(code) {\n      return this.http.post(`${this.apiUrl}/2fa/confirm`, {\n        message: code\n      });\n    }\n    send2FAViaEmail() {\n      return this.http.post(`${this.apiUrl}/2fa/send-email`, {});\n    }\n    getUserInfo() {\n      return this.http.get(`${this.apiUrl}/me`).pipe(tap(response => {\n        const currentUser = this.currentUserSubject.value;\n        if (currentUser) {\n          currentUser.twoFactorEnabled = response.twoFactorEnabled;\n          this.currentUserSubject.next(currentUser);\n        }\n      }));\n    }\n    updateProfile(data) {\n      return this.http.put(`${this.apiUrl}/profile`, data).pipe(tap(response => {\n        // Update localStorage and current user\n        const currentUser = this.currentUserSubject.value;\n        if (currentUser && response.token !== undefined) {\n          const updatedUser = {\n            ...currentUser,\n            ...response\n          };\n          localStorage.setItem('user', JSON.stringify(updatedUser));\n          this.currentUserSubject.next(updatedUser);\n        }\n      }));\n    }\n    changePassword(data) {\n      return this.http.post(`${this.apiUrl}/change-password`, data);\n    }\n    activateAccount(token, password, confirmPassword) {\n      return this.http.post(`${this.apiUrl}/activate-account`, {\n        token,\n        password,\n        confirmPassword\n      }).pipe(tap(response => {\n        if (response.token) {\n          localStorage.setItem('token', response.token);\n          localStorage.setItem('user', JSON.stringify(response));\n          this.currentUserSubject.next(response);\n        }\n      }));\n    }\n    logout() {\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      this.currentUserSubject.next(null);\n      this.router.navigate(['/login']);\n    }\n    getToken() {\n      return localStorage.getItem('token');\n    }\n    isAuthenticated() {\n      return !!this.getToken();\n    }\n    getCurrentUser() {\n      return this.currentUserSubject.value;\n    }\n    getUserRole() {\n      const token = this.getToken();\n      if (!token) return null;\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        return payload.role || null;\n      } catch (e) {\n        return null;\n      }\n    }\n    isLoggedIn() {\n      return this.isAuthenticated();\n    }\n    hasRole(role) {\n      return this.getUserRole() === role;\n    }\n    navigateByRole() {\n      const role = this.getUserRole();\n      switch (role) {\n        case 'ADMIN':\n          this.router.navigate(['/admin-dashboard']);\n          break;\n        case 'INSTRUCTOR':\n          this.router.navigate(['/instructor-dashboard']);\n          break;\n        case 'STUDENT':\n          this.router.navigate(['/student-dashboard']);\n          break;\n        default:\n          this.router.navigate(['/login']);\n      }\n    }\n    getUserId() {\n      const token = this.getToken();\n      if (!token) return null;\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        return payload.userId || null;\n      } catch (e) {\n        return null;\n      }\n    }\n    static {\n      this.ɵfac = function AuthService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AuthService,\n        factory: AuthService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}