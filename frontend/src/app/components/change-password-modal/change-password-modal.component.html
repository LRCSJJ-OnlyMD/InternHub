<div class="modal-overlay" *ngIf="isOpen" (click)="close()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ mandatory ? 'Change Your Password' : 'Change Password' }}</h2>
      <button *ngIf="!mandatory" class="close-btn" (click)="close()">&times;</button>
    </div>

    <div class="modal-body">
      <p *ngIf="mandatory" class="warning-text">
        You must change your password before continuing. This is your first login with a temporary password.
      </p>

      <div *ngIf="errorMessage" class="alert alert-error">
        {{ errorMessage }}
      </div>

      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>

      <form (ngSubmit)="changePassword()" *ngIf="!successMessage">
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input
            type="password"
            id="currentPassword"
            name="currentPassword"
            [(ngModel)]="currentPassword"
            placeholder="Enter current password"
            [disabled]="loading"
            required
          />
        </div>

        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input
            type="password"
            id="newPassword"
            name="newPassword"
            [(ngModel)]="newPassword"
            placeholder="Enter new password (min 8 characters)"
            [disabled]="loading"
            required
          />
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            placeholder="Confirm new password"
            [disabled]="loading"
            required
          />
        </div>

        <div class="modal-footer">
          <button *ngIf="!mandatory" type="button" class="btn-secondary" (click)="close()" [disabled]="loading">
            Cancel
          </button>
          <button type="submit" class="btn-primary" [disabled]="loading">
            <span *ngIf="!loading">Change Password</span>
            <span *ngIf="loading">Changing...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
