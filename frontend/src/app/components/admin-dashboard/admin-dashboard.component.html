<div class="dashboard-container">
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="/images/logo/logo.png" alt="InternHub" class="sidebar-logo">
      <h2>Admin Panel</h2>
    </div>
    <nav class="sidebar-nav">
      <a class="nav-item" [class.active]="activeSection === 'overview'" (click)="setActiveSection('overview')">
        <span class="nav-label">Overview</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'internships'" (click)="setActiveSection('internships')">
        <span class="nav-label">All Internships</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'users'" (click)="setActiveSection('users')">
        <span class="nav-label">User Management</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'sectors'" (click)="setActiveSection('sectors')">
        <span class="nav-label">Sectors</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'activity-logs'" (click)="navigateToActivityLogs()">
        <span class="nav-label">Activity Logs</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'reports'" (click)="setActiveSection('reports')">
        <span class="nav-label">Reports</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'settings'" (click)="setActiveSection('settings')">
        <span class="nav-label">Settings</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <button class="btn-logout" (click)="logout()">
        <span class="nav-label">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="content-header">
      <h1>{{ getSectionTitle() }}</h1>
      <div class="header-actions">
        <app-notification-bell></app-notification-bell>
        <div class="user-info">
          <span class="user-name">{{ userName }}</span>
          <span class="user-role">Administrator</span>
        </div>
      </div>
    </header>

    <!-- Statistics Section -->
    <div class="content-section" *ngIf="activeSection === 'overview'">
      <!-- Stats Cards Grid -->
      <div class="overview-stats-grid">
        <div class="stat-card-modern">
          <div class="stat-icon primary-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ internships.length }}</div>
            <div class="stat-label">Total Internships</div>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon success-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ getStatusCount('VALIDATED') }}</div>
            <div class="stat-label">Validated</div>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon warning-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ getStatusCount('PENDING_VALIDATION') }}</div>
            <div class="stat-label">Pending</div>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon info-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ instructors.length }}</div>
            <div class="stat-label">Instructors</div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="statistics-section">
        <h2>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          Visual Analytics
        </h2>
        <div class="charts-grid">
          <div class="chart-container">
            <h3 class="chart-title">Internship Status Distribution</h3>
            <canvas id="statusChart"></canvas>
          </div>
          <div class="chart-container">
            <h3 class="chart-title">Internships by Sector</h3>
            <canvas id="sectorChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Internships Section -->
    <div class="content-section" *ngIf="activeSection === 'internships'">
      <div class="search-section">
        <h3>Search & Filter Internships</h3>
        <form [formGroup]="searchForm" (ngSubmit)="searchInternships()" class="search-form">
      <div class="form-row">
        <div class="form-group">
          <label>Sector</label>
          <select formControlName="sectorId" class="form-control">
            <option value="">All Sectors</option>
            <option *ngFor="let sector of sectors" [value]="sector.id">{{ sector.name }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Status</label>
          <select formControlName="status" class="form-control">
            <option value="">All Statuses</option>
            <option value="DRAFT">Draft</option>
            <option value="PENDING_VALIDATION">Pending Validation</option>
            <option value="VALIDATED">Validated</option>
            <option value="REFUSED">Refused</option>
          </select>
        </div>

        <div class="form-group">
          <label>Company Name</label>
          <input type="text" formControlName="companyName" class="form-control" placeholder="Search by company">
        </div>

        <div class="form-group">
          <label>Student ID</label>
          <input type="number" formControlName="studentId" class="form-control" placeholder="Student ID">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Start Date From</label>
          <input type="date" formControlName="startDateFrom" class="form-control">
        </div>

        <div class="form-group">
          <label>Start Date To</label>
          <input type="date" formControlName="startDateTo" class="form-control">
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-search">Search</button>
          <button type="button" class="btn-reset" (click)="resetSearch()">Reset</button>
        </div>
      </div>
        </form>
      </div>

      <div class="internships-section">
      <h2>All Internships ({{ internships.length }})</h2>
      <div class="table-container">
      <table *ngIf="internships.length > 0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Student</th>
            <th>Company</th>
            <th>Sector</th>
            <th>Period</th>
            <th>Status</th>
            <th>Instructor</th>
            <th>Report</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let internship of internships">
            <td>{{ internship.id }}</td>
            <td>{{ internship.title }}</td>
            <td>{{ internship.studentName }}</td>
            <td>{{ internship.companyName }}</td>
            <td>{{ internship.sectorName }}</td>
            <td>{{ internship.startDate }} to {{ internship.endDate }}</td>
            <td>
              <span [class]="getStatusClass(internship.status)" class="status-badge">
                {{ internship.status }}
              </span>
            </td>
            <td>{{ internship.instructorName || 'Not assigned' }}</td>
            <td>
              <button *ngIf="internship.hasReport" class="btn-download" (click)="downloadReport(internship.id)">
                Download
              </button>
              <span *ngIf="!internship.hasReport" class="no-report">No report</span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-reassign" (click)="reassignInstructor(internship.id)" 
                        *ngIf="internship.status === InternshipStatus.VALIDATED">
                  Reassign
                </button>
                <button class="btn-delete" (click)="deleteInternship(internship.id)">
                  Delete
                </button>
              </div>
            </td>
          </tr>
        </tbody>
        </table>

        <div *ngIf="internships.length === 0" class="empty-state">
          <p>No internships found</p>
        </div>
      </div>
    </div>
    </div>

    <!-- User Management Section -->
    <div class="content-section" *ngIf="activeSection === 'users'">
      <div class="user-management">
        <!-- Success/Error Alert -->
        <div *ngIf="alertMessage" [class]="alertType === 'success' ? 'alert alert-success' : 'alert alert-error'">
          {{ alertMessage }}
        </div>

        <!-- Create Instructor Form -->
        <div class="create-instructor-form">
          <div class="form-card-modern">
            <div class="form-card-header">
              <h3>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                Create Instructor Account
              </h3>
              <p class="form-card-description">Add a new instructor and assign them to one or more sectors</p>
            </div>
            <form [formGroup]="instructorForm" (ngSubmit)="createInstructor()">
              <div class="form-grid">
                <div class="form-group">
                  <label>First Name *</label>
                  <input type="text" formControlName="firstName" class="form-control-modern" placeholder="Enter first name" required>
                </div>
                <div class="form-group">
                  <label>Last Name *</label>
                  <input type="text" formControlName="lastName" class="form-control-modern" placeholder="Enter last name" required>
                </div>
              </div>

              <div class="form-group form-grid-full">
                <label>Email Address *</label>
                <input type="email" formControlName="email" class="form-control-modern" placeholder="instructor@example.com" required>
              </div>

              <div class="form-group form-grid-full">
                <label>Assign Sectors *</label>
                <select formControlName="sectorIds" class="form-control-modern" multiple size="5" required title="Select one or more sectors for the instructor">
                  <option *ngFor="let sector of sectors" [value]="sector.id">{{ sector.name }}</option>
                </select>
                <small class="form-hint">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z" />
                  </svg>
                  Hold Ctrl (Windows) or Cmd (Mac) to select multiple sectors
                </small>
              </div>

              <div class="modal-actions">
                <button type="submit" class="btn-primary" [disabled]="!instructorForm.valid || isCreatingInstructor">
                  {{ isCreatingInstructor ? 'Creating...' : 'Create Instructor' }}
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Instructors List -->
        <div class="users-list">
          <div class="list-header">
            <h3>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              Existing Instructors
            </h3>
            <span class="count-badge-large">{{ instructors.length }}</span>
          </div>
          <div *ngIf="instructors.length === 0" class="empty-state-modern">
            <div class="empty-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <p>No instructors yet. Create one above to get started.</p>
          </div>
          <div class="table-container" *ngIf="instructors.length > 0">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Assigned Sectors</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let instructor of instructors">
                  <td><span class="id-badge">{{ instructor.id }}</span></td>
                  <td>
                    <strong>{{ instructor.firstName }} {{ instructor.lastName }}</strong>
                    <span class="role-badge">Instructor</span>
                  </td>
                  <td>{{ instructor.email }}</td>
                  <td>
                    <div class="sectors-tags">
                      <span class="sector-tag" *ngFor="let sectorName of instructor.sectorNames">
                        {{ sectorName }}
                      </span>
                      <span class="no-data" *ngIf="!instructor.sectorNames || instructor.sectorNames.length === 0">
                        No sectors assigned
                      </span>
                    </div>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn-delete" (click)="deleteInstructor(instructor.id)">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                        Delete
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Sectors Section -->
    <div class="content-section" *ngIf="activeSection === 'sectors'">
      <div class="sectors-management">
        <!-- Success/Error Alert -->
        <div *ngIf="sectorAlertMessage" [class]="sectorAlertType === 'success' ? 'alert alert-success' : 'alert alert-error'">
          {{ sectorAlertMessage }}
        </div>

        <!-- Create/Edit Sector Form -->
        <div class="form-card">
          <h3>{{ editingSectorId ? 'Edit Sector' : 'Create New Sector' }}</h3>
          <form [formGroup]="sectorForm" (ngSubmit)="saveSector()">
            <div class="form-grid">
              <div class="form-group">
                <label>Sector Name *</label>
                <input type="text" formControlName="name" class="form-control" placeholder="e.g., Computer Science" required>
              </div>
              <div class="form-group">
                <label>Code *</label>
                <input type="text" formControlName="code" class="form-control" placeholder="e.g., CS" required>
              </div>
            </div>

            <div class="form-group form-grid-full">
              <label>Description</label>
              <textarea formControlName="description" class="form-control" rows="3" placeholder="Brief description of the sector"></textarea>
            </div>

            <div class="modal-actions">
              <button type="submit" class="btn-primary" [disabled]="!sectorForm.valid || isSavingSector">
                {{ isSavingSector ? 'Saving...' : (editingSectorId ? 'Update Sector' : 'Create Sector') }}
              </button>
              <button type="button" class="btn-secondary" (click)="cancelEditSector()" *ngIf="editingSectorId">
                Cancel
              </button>
            </div>
          </form>
        </div>

        <!-- Sectors List -->
        <div class="sectors-list">
          <h3>All Sectors ({{ sectors.length }})</h3>
          <div *ngIf="sectors.length === 0" class="empty-state">
            <p>No sectors yet. Create one above.</p>
          </div>
          
          <div class="table-container" *ngIf="sectors.length > 0">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Code</th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Instructors</th>
                  <th>Internships</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let sector of sectors">
                  <td>{{ sector.id }}</td>
                  <td><span class="sector-code-badge">{{ sector.code }}</span></td>
                  <td><strong>{{ sector.name }}</strong></td>
                  <td>{{ sector.description || '-' }}</td>
                  <td>
                    <span class="count-badge">{{ getSectorInstructorsCount(sector.id) }}</span>
                  </td>
                  <td>
                    <span class="count-badge">{{ getSectorInternshipsCount(sector.id) }}</span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn-edit" (click)="editSector(sector)" title="Edit sector">
                        Edit
                      </button>
                      <button class="btn-delete" (click)="deleteSector(sector.id)" title="Delete sector">
                        Delete
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Reports Section -->
    <div class="content-section" *ngIf="activeSection === 'reports'">
      <div class="reports-management">
        <h3>Internship Reports Management</h3>
        
        <!-- Reports Statistics -->
        <div class="reports-stats">
          <div class="stat-card">
            <div class="stat-value">{{ getReportsCount('total') }}</div>
            <div class="stat-label">Total Reports</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ getReportsCount('validated') }}</div>
            <div class="stat-label">Validated Internships</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ getReportsCount('pending') }}</div>
            <div class="stat-label">Pending Reports</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ getReportsCount('missing') }}</div>
            <div class="stat-label">Missing Reports</div>
          </div>
        </div>

        <!-- Export Buttons -->
        <div class="export-actions">
          <h4>Export Data</h4>
          <div class="export-buttons">
            <!-- Internships Export -->
            <div class="export-group">
              <label>Internships Export</label>
              <div class="date-filter">
                <input type="date" [(ngModel)]="exportFromDate" class="form-control" placeholder="From date">
                <input type="date" [(ngModel)]="exportToDate" class="form-control" placeholder="To date">
              </div>
              <div class="button-group">
                <button class="btn btn-success" (click)="exportInternships('xlsx')" title="Export internships to Excel format">
                  üìà Excel
                </button>
                <button class="btn btn-success" (click)="exportInternships('csv')" title="Export internships to CSV format">
                  üìä CSV
                </button>
              </div>
            </div>

            <!-- Users Export -->
            <div class="export-group">
              <label>Users Export</label>
              <div class="button-group">
                <button class="btn btn-primary" (click)="exportUsers('xlsx')" title="Export users to Excel format">
                  üìà Excel
                </button>
                <button class="btn btn-primary" (click)="exportUsers('csv')" title="Export users to CSV format">
                  üìä CSV
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Reports Filter -->
        <div class="form-card reports-filter-card">
          <h4>Filter Reports</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Sector</label>
              <select [(ngModel)]="reportFilterSector" (change)="filterReports()" class="form-control" title="Filter reports by sector">
                <option value="">All Sectors</option>
                <option *ngFor="let sector of sectors" [value]="sector.id">{{ sector.name }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Status</label>
              <select [(ngModel)]="reportFilterStatus" (change)="filterReports()" class="form-control" title="Filter reports by submission status">
                <option value="">All Statuses</option>
                <option value="with-report">With Report</option>
                <option value="without-report">Without Report</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Reports Table -->
        <div class="table-container reports-table-container">
          <table *ngIf="getFilteredReportsInternships().length > 0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Student</th>
                <th>Company</th>
                <th>Sector</th>
                <th>Period</th>
                <th>Status</th>
                <th>Report</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let internship of getFilteredReportsInternships()">
                <td>{{ internship.id }}</td>
                <td>{{ internship.studentName }}</td>
                <td>{{ internship.companyName }}</td>
                <td>{{ internship.sectorName }}</td>
                <td>{{ internship.startDate }} to {{ internship.endDate }}</td>
                <td>
                  <span [class]="getStatusClass(internship.status)" class="status-badge">
                    {{ internship.status }}
                  </span>
                </td>
                <td>
                  <span *ngIf="internship.hasReport" class="report-indicator success">‚úì Submitted</span>
                  <span *ngIf="!internship.hasReport" class="report-indicator missing">‚úó Missing</span>
                </td>
                <td>
                  <button *ngIf="internship.hasReport" class="btn-download" (click)="downloadReport(internship.id)">
                    Download
                  </button>
                  <span *ngIf="!internship.hasReport" class="text-muted">-</span>
                </td>
              </tr>
            </tbody>
          </table>
          
          <div *ngIf="getFilteredReportsInternships().length === 0" class="empty-state">
            <p>No reports found matching the selected filters.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Section -->
    <div class="content-section" *ngIf="activeSection === 'settings'">
      <div class="settings-container">
        
        <!-- Success/Error Messages -->
        <div *ngIf="settingsSuccessMessage" class="alert alert-success">
          {{ settingsSuccessMessage }}
        </div>
        <div *ngIf="settingsErrorMessage" class="alert alert-error">
          {{ settingsErrorMessage }}
        </div>

        <!-- Account Information -->
        <div class="settings-section">
          <h2>Account Information</h2>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Email Address</span>
              <span class="info-value">{{ userEmail }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Full Name</span>
              <span class="info-value">{{ userName }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Role</span>
              <span class="info-value">Administrator</span>
            </div>
          </div>
        </div>

        <!-- Security Settings -->
        <div class="settings-section">
          <h2>Security Settings</h2>
          
          <div class="security-card">
            <div class="security-header">
              <div>
                <h3>Two-Factor Authentication (2FA)</h3>
                <p class="security-description">
                  Add an extra layer of security to your account by enabling two-factor authentication.
                </p>
              </div>
              <div class="twofa-status">
                <span class="status-badge" [class.enabled]="twoFactorEnabled" [class.disabled]="!twoFactorEnabled">
                  {{ twoFactorEnabled ? 'Enabled' : 'Disabled' }}
                </span>
              </div>
            </div>

            <!-- Enable 2FA -->
            <div *ngIf="!twoFactorEnabled && !showQRCode" class="security-action">
              <button class="btn btn-primary" (click)="enableTwoFactor()" [disabled]="settingsLoading">
                {{ settingsLoading ? 'Enabling...' : 'Enable Two-Factor Authentication' }}
              </button>
            </div>

            <!-- QR Code Display -->
            <div *ngIf="showQRCode" class="qr-code-container">
              <h4>Scan QR Code</h4>
              <p>Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)</p>
              <div class="qr-code">
                <img [src]="qrCodeUrl" alt="QR Code" />
              </div>
              <p class="secret-key">Or enter this key manually: <code>{{ twoFactorSecret }}</code></p>
              
              <div class="confirmation-form">
                <label for="confirmationCode">Enter the 6-digit code from your app</label>
                <input 
                  type="text" 
                  id="confirmationCode" 
                  [(ngModel)]="confirmationCode" 
                  placeholder="000000"
                  maxlength="6"
                  class="form-control"
                />
                <div class="button-group">
                  <button class="btn btn-primary" (click)="confirm2FA()" [disabled]="settingsLoading || confirmationCode.length !== 6">
                    {{ settingsLoading ? 'Verifying...' : 'Verify and Enable' }}
                  </button>
                  <button class="btn btn-secondary" (click)="cancelQRSetup()">
                    Cancel
                  </button>
                </div>
              </div>
            </div>

            <!-- Disable 2FA -->
            <div *ngIf="twoFactorEnabled" class="security-action">
              <button class="btn btn-danger" (click)="disableTwoFactor()" [disabled]="settingsLoading">
                {{ settingsLoading ? 'Disabling...' : 'Disable Two-Factor Authentication' }}
              </button>
              <p class="warning-text">‚ö†Ô∏è Disabling 2FA will make your account less secure.</p>
            </div>
          </div>
        </div>

      </div>
    </div>

  </main>
</div>
