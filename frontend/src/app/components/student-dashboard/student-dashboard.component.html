<div class="dashboard-container">
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="/images/logo/logo.png" alt="InternHub" class="sidebar-logo">
      <h2>Student Portal</h2>
    </div>
    <nav class="sidebar-nav">
      <a class="nav-item" [class.active]="activeSection === 'overview'" (click)="setActiveSection('overview')">
        <mat-icon>dashboard</mat-icon>
        <span class="nav-label">Overview</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'internships'" (click)="setActiveSection('internships')">
        <mat-icon>work</mat-icon>
        <span class="nav-label">My Internships</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'create'" (click)="setActiveSection('create')">
        <mat-icon>add_circle</mat-icon>
        <span class="nav-label">Create New</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'reports'" (click)="setActiveSection('reports')">
        <mat-icon>description</mat-icon>
        <span class="nav-label">Reports</span>
      </a>
      <a class="nav-item" [class.active]="activeSection === 'settings'" (click)="setActiveSection('settings')">
        <mat-icon>settings</mat-icon>
        <span class="nav-label">Settings</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <button class="btn-logout" (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span class="nav-label">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="content-header">
      <h1>{{ getSectionTitle() }}</h1>
      <div class="header-actions">
        <app-notification-bell></app-notification-bell>
        <div class="user-info">
          <span class="user-name">{{ userName }}</span>
          <span class="user-role">Student</span>
        </div>
      </div>
    </header>

    <!-- Overview Section -->
    <div class="content-section" *ngIf="activeSection === 'overview'">
      <!-- Stats Cards Grid -->
      <div class="overview-stats-grid">
        <div class="stat-card-modern">
          <div class="stat-icon primary-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ internships.length }}</div>
            <div class="stat-label">Total Internships</div>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon warning-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ getStatusCount('DRAFT') }}</div>
            <div class="stat-label">Drafts</div>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon info-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ getStatusCount('PENDING_VALIDATION') }}</div>
            <div class="stat-label">Pending</div>
          </div>
        </div>
        <div class="stat-card-modern">
          <div class="stat-icon success-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ getStatusCount('VALIDATED') }}</div>
            <div class="stat-label">Validated</div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions-section">
        <h2>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
          Quick Actions
        </h2>
        <div class="actions-grid">
          <button class="action-card" (click)="showCreateForm()">
            <div class="action-icon create">
              <mat-icon>add_circle</mat-icon>
            </div>
            <div class="action-content">
              <h3>Create Internship</h3>
              <p>Start a new internship application</p>
            </div>
          </button>
          <button class="action-card" (click)="setActiveSection('internships')">
            <div class="action-icon view">
              <mat-icon>list_alt</mat-icon>
            </div>
            <div class="action-content">
              <h3>View All</h3>
              <p>{{ internships.length }} internships in your portfolio</p>
            </div>
          </button>
        </div>
      </div>

      <!-- Recent Internships -->
      <div class="recent-section" *ngIf="internships.length > 0">
        <h2>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Recent Activity
        </h2>
        <div class="recent-grid">
          <div class="recent-card" *ngFor="let internship of internships.slice(0, 3)">
            <div class="recent-header">
              <h4>{{ internship.title }}</h4>
              <span class="status-badge-small" [ngClass]="getStatusClass(internship.status)">
                {{ internship.status }}
              </span>
            </div>
            <p class="recent-company">{{ internship.companyName }}</p>
            <p class="recent-date">{{ internship.startDate }} - {{ internship.endDate }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Internships List Section -->
    <div class="content-section" *ngIf="activeSection === 'internships'">
      <div class="section-actions">
        <button class="btn-primary-action" (click)="showCreateForm()" *ngIf="!isCreating && !isEditing">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          New Internship
        </button>
      </div>

      <!-- Create/Edit Form -->
      <div class="form-card-modern" *ngIf="isCreating || isEditing">
        <div class="form-header-modern">
          <h2>{{ isEditing ? 'Edit Internship' : 'Create New Internship' }}</h2>
          <button class="btn-close-form" (click)="cancelForm()">×</button>
        </div>
        <form [formGroup]="internshipForm" (ngSubmit)="saveInternship()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Title</mat-label>
            <input matInput formControlName="title" placeholder="e.g., Full Stack Development Internship" required>
            <mat-icon matPrefix>work</mat-icon>
            <mat-error *ngIf="internshipForm.get('title')?.hasError('required')">
              Title is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" rows="3" placeholder="Describe your internship tasks and responsibilities"></textarea>
            <mat-icon matPrefix>description</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Company Name</mat-label>
            <input matInput formControlName="companyName" placeholder="e.g., TechCorp Morocco" required>
            <mat-icon matPrefix>business</mat-icon>
            <mat-error *ngIf="internshipForm.get('companyName')?.hasError('required')">
              Company name is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Company Address</mat-label>
            <input matInput formControlName="companyAddress" placeholder="e.g., Casablanca, Morocco">
            <mat-icon matPrefix>location_on</mat-icon>
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field-half">
              <mat-label>Start Date</mat-label>
              <input matInput [matDatepicker]="startPicker" formControlName="startDate" required>
              <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
              <mat-datepicker #startPicker></mat-datepicker>
              <mat-icon matPrefix>event</mat-icon>
              <mat-error *ngIf="internshipForm.get('startDate')?.hasError('required')">
                Start date is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field-half">
              <mat-label>End Date</mat-label>
              <input matInput [matDatepicker]="endPicker" formControlName="endDate" required>
              <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
              <mat-icon matPrefix>event</mat-icon>
              <mat-error *ngIf="internshipForm.get('endDate')?.hasError('required')">
                End date is required
              </mat-error>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Sector</mat-label>
            <mat-select formControlName="sectorId" required>
              <mat-option *ngIf="sectorsLoading" disabled>Loading sectors...</mat-option>
              <mat-option *ngFor="let sector of sectors" [value]="sector.id">
                {{ sector.name }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>category</mat-icon>
            <mat-error *ngIf="internshipForm.get('sectorId')?.hasError('required')">
              Sector is required
            </mat-error>
            <mat-hint *ngIf="sectorsError" class="error-hint">{{ sectorsError }}</mat-hint>
          </mat-form-field>

          <div class="form-group">
            <label>Internship Report (PDF) <span class="optional-label">- Optional</span></label>
            <div class="file-upload-area">
              <input 
                type="file" 
                id="reportFile" 
                accept="application/pdf" 
                (change)="onReportFileSelected($event)"
                class="file-input-hidden">
              <label for="reportFile" class="file-upload-label">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                </svg>
                <span *ngIf="!selectedFile">Choose PDF file or drag and drop</span>
                <span *ngIf="selectedFile" class="file-selected">{{ selectedFile.name }}</span>
              </label>
              <p class="file-help-text">Upload your internship report (Max 10MB)</p>
            </div>
          </div>

          <div class="form-actions-modern">
            <button mat-raised-button type="button" (click)="cancelForm()">
              <mat-icon>close</mat-icon>
              Cancel
            </button>
            <button mat-raised-button color="primary" type="submit" [disabled]="internshipForm.invalid">
              <mat-icon>check</mat-icon>
              Save Internship
            </button>
          </div>
        </form>
      </div>

      <!-- Internships Grid -->
      <div class="internships-modern-grid" *ngIf="!isCreating && !isEditing">
        <div class="internship-card-student" *ngFor="let internship of internships">
          <div class="card-header-student">
            <div class="header-content">
              <h3>{{ internship.title }}</h3>
              <span class="status-badge" [ngClass]="getStatusClass(internship.status)">
                {{ internship.status }}
              </span>
            </div>
          </div>

          <div class="card-body-student">
            <div class="info-grid">
              <div class="info-item">
                <mat-icon class="info-icon">business</mat-icon>
                <div>
                  <span class="info-label">Company</span>
                  <span class="info-value">{{ internship.companyName }}</span>
                </div>
              </div>
              <div class="info-item">
                <mat-icon class="info-icon">category</mat-icon>
                <div>
                  <span class="info-label">Sector</span>
                  <span class="info-value">{{ internship.sectorName }}</span>
                </div>
              </div>
              <div class="info-item">
                <mat-icon class="info-icon">date_range</mat-icon>
                <div>
                  <span class="info-label">Period</span>
                  <span class="info-value">{{ internship.startDate }} to {{ internship.endDate }}</span>
                </div>
              </div>
              <div class="info-item">
                <mat-icon class="info-icon" [class.text-muted]="!internship.instructorName">{{ internship.instructorName ? 'person' : 'person_outline' }}</mat-icon>
                <div>
                  <span class="info-label">Supervisor</span>
                  <span class="info-value" [class.text-muted]="!internship.instructorName">{{ internship.instructorName || 'Not assigned yet' }}</span>
                </div>
              </div>
            </div>

            <div class="refusal-section" *ngIf="internship.refusalComment">
              <div class="refusal-badge">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Refusal Reason
              </div>
              <p class="refusal-text">{{ internship.refusalComment }}</p>
            </div>

            <div class="report-status" *ngIf="internship.hasReport">
              <span class="report-badge">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Report Uploaded
              </span>
            </div>
          </div>

          <div class="card-actions-student">
            <button *ngIf="canModify(internship)" class="btn-edit-modern" (click)="editInternship(internship)">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
              Edit
            </button>
            
            <button *ngIf="internship.status === InternshipStatus.DRAFT" class="btn-submit-modern" (click)="submitInternship(internship.id)">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
              </svg>
              Submit for Validation
            </button>

            <label *ngIf="internship.status !== InternshipStatus.DRAFT && !internship.hasReport" class="btn-upload-modern">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
              </svg>
              Upload Report
              <input type="file" accept="application/pdf" (change)="onFileSelected($event, internship.id)" style="display: none;">
            </label>

            <button *ngIf="internship.hasReport" class="btn-download-modern" (click)="downloadReport(internship.id, internship.title)">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Download Report
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="internships.length === 0 && !isCreating && !isEditing" class="empty-state-modern">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <h3>No Internships Yet</h3>
        <p>Create your first internship to get started</p>
        <button class="btn-create-first" (click)="showCreateForm()">Create Internship</button>
      </div>
    </div>

    <!-- Create Section -->
    <div class="content-section" *ngIf="activeSection === 'create'">
      <div class="create-prompt-modern">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        <h2>Create New Internship</h2>
        <p>Start documenting your internship experience</p>
        <button class="btn-primary-large" (click)="showCreateForm()">
          Get Started
        </button>
      </div>
    </div>

    <!-- Reports Section -->
    <div class="content-section" *ngIf="activeSection === 'reports'">
      <div class="reports-section-modern">
        <h2>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          My Reports
        </h2>
        <div class="reports-grid-modern">
          <div class="report-card-modern" *ngFor="let internship of internships">
            <div *ngIf="internship.hasReport">
              <div class="report-header">
                <h4>{{ internship.title }}</h4>
                <span class="report-status-badge">
                  <mat-icon>check_circle</mat-icon>
                  Uploaded
                </span>
              </div>
              <p class="report-company">{{ internship.companyName }}</p>
              <p class="report-sector">{{ internship.sectorName }}</p>
              <div class="report-actions">
                <button class="btn-view-report" (click)="viewReport(internship.id)">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                  View PDF
                </button>
                <button class="btn-download-report" (click)="downloadReport(internship.id, internship.title)">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                  Download PDF
                </button>
              </div>
            </div>
          </div>
          <div *ngIf="!hasAnyReports()" class="empty-state-modern">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <h3>No Reports Yet</h3>
            <p>Upload reports for your validated internships</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Section -->
    <div class="content-section" *ngIf="activeSection === 'settings'">
      <div class="settings-container">
        
        <!-- Success/Error Messages -->
        <div *ngIf="settingsSuccessMessage" class="alert alert-success">
          {{ settingsSuccessMessage }}
        </div>
        <div *ngIf="settingsErrorMessage" class="alert alert-error">
          {{ settingsErrorMessage }}
        </div>

        <!-- Edit Profile Section -->
        <div class="settings-section-modern">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            Profile Information
          </h2>
          <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" id="firstName" formControlName="firstName" class="form-control" placeholder="Enter your first name"/>
              <small *ngIf="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched" class="error-message">
                First name is required (2-50 characters)
              </small>
            </div>

            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" formControlName="lastName" class="form-control" placeholder="Enter your last name"/>
              <small *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched" class="error-message">
                Last name is required (2-50 characters)
              </small>
            </div>

            <div class="form-group">
              <label for="email">Email Address</label>
              <input type="email" id="email" formControlName="email" class="form-control" placeholder="Enter your email"/>
              <small *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" class="error-message">
                Valid email is required
              </small>
            </div>

            <button type="submit" class="btn btn-primary" [disabled]="profileForm.invalid || settingsLoading">
              {{ settingsLoading ? 'Updating...' : 'Update Profile' }}
            </button>
          </form>
        </div>

        <!-- Change Password Section -->
        <div class="settings-section-modern">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
            </svg>
            Change Password
          </h2>
          <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
            <div class="form-group">
              <label for="currentPassword">Current Password</label>
              <input type="password" id="currentPassword" formControlName="currentPassword" class="form-control" placeholder="Enter current password"/>
              <small *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched" class="error-message">
                Current password is required
              </small>
            </div>

            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input type="password" id="newPassword" formControlName="newPassword" class="form-control" placeholder="Enter new password (min 6 characters)"/>
              <small *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" class="error-message">
                New password must be at least 6 characters
              </small>
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirm New Password</label>
              <input type="password" id="confirmPassword" formControlName="confirmPassword" class="form-control" placeholder="Confirm new password"/>
              <small *ngIf="passwordForm.hasError('mismatch') && passwordForm.get('confirmPassword')?.touched" class="error-message">
                Passwords do not match
              </small>
            </div>

            <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid || settingsLoading">
              {{ settingsLoading ? 'Changing...' : 'Change Password' }}
            </button>
          </form>
        </div>

        <!-- Security Settings -->
        <div class="settings-section-modern">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
            Security Settings
          </h2>
          
          <div class="security-card-modern">
            <div class="security-header">
              <div>
                <h3>Two-Factor Authentication (2FA)</h3>
                <p class="security-description">
                  Add an extra layer of security to your account by enabling two-factor authentication.
                </p>
              </div>
              <div class="twofa-status">
                <span class="status-badge" [class.enabled]="twoFactorEnabled" [class.disabled]="!twoFactorEnabled">
                  {{ twoFactorEnabled ? 'Enabled' : 'Disabled' }}
                </span>
              </div>
            </div>

            <!-- Enable 2FA -->
            <div *ngIf="!twoFactorEnabled && !showQRCode" class="security-action">
              <button class="btn btn-primary" (click)="enableTwoFactor()" [disabled]="settingsLoading">
                {{ settingsLoading ? 'Enabling...' : 'Enable Two-Factor Authentication' }}
              </button>
            </div>

            <!-- QR Code Display -->
            <div *ngIf="showQRCode" class="qr-code-container-modern">
              <h4>Scan QR Code</h4>
              <p>Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)</p>
              <div class="qr-code">
                <img [src]="qrCodeUrl" alt="QR Code" />
              </div>
              <p class="secret-key">Or enter this key manually: <code>{{ twoFactorSecret }}</code></p>
              
              <div class="confirmation-form">
                <label for="confirmationCode">Enter the 6-digit code from your app</label>
                <input type="text" id="confirmationCode" [(ngModel)]="confirmationCode" placeholder="000000" maxlength="6" class="form-control"/>
                <div class="button-group">
                  <button class="btn btn-primary" (click)="confirm2FA()" [disabled]="settingsLoading || confirmationCode.length !== 6">
                    {{ settingsLoading ? 'Verifying...' : 'Verify and Enable' }}
                  </button>
                  <button class="btn btn-secondary" (click)="cancelQRSetup()">
                    Cancel
                  </button>
                </div>
              </div>
            </div>

            <!-- Disable 2FA -->
            <div *ngIf="twoFactorEnabled" class="security-action">
              <button class="btn btn-danger" (click)="disableTwoFactor()" [disabled]="settingsLoading">
                {{ settingsLoading ? 'Disabling...' : 'Disable Two-Factor Authentication' }}
              </button>
              <p class="warning-text">⚠️ Disabling 2FA will make your account less secure.</p>
            </div>
          </div>
        </div>

      </div>
    </div>

  </main>
</div>
